<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poc Chatbot</title>
    <style>
      body {
        padding: 0 !important;
        margin: 0 !important;
      }

      #root {
        background-color: red;
        padding: none;
        margin: none;
        margin-top: -21px;
        /* height: 100vh; */
      }
      .content {
        background-color: green;
        height: 91.8vh;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
      const App = () => {
        const containerRef = React.useRef(null);
        const [count, setCount] = React.useState(0);

        const healthEventSource = new EventSource("/api/health");

        const listeningHealth = () => {
          healthEventSource.onmessage = ({ data }) => {
            let response = JSON.parse(data);
            const healthItem = document.createElement("li");
            healthItem.className = "health-list-item";
            healthItem.innerText = response.message;
            healthList.appendChild(healthItem);

            // lastUpdate.innerText = response.message;
          };

          healthEventSource.onerror = (error) => {
            console.error(error);
          };
        };

        const closeConnet = () => {
          if (healthEventSource.readyState !== EventSource.CLOSED) {
            healthEventSource.close();
          }
        };

        React.useEffect(() => {
          const container = containerRef.current;

          if (!container) {
            return;
          }

          container.appendChild(svg);
        }, [count]);

        return (
          <div
            style={{
              backgroundColor: "orange",
            }}
          >
            <h4>Poc Chatbot</h4>
            <div
              className="content"
              style={{
                flex: 1,
                display: "flex",
                flexDirection: "column",
                gap: "0.5rem",
                backgroundColor: "blue",
                // height: "100%",
              }}
            >
              <div
                ref={containerRef}
                style={{
                  flex: 1,
                  backgroundColor: "yellow",
                }}
              >
                seccion de mensajes
              </div>
              <div
                style={{
                  //   flex: 1,
                  display: "flex",
                  flexDirection: "row",
                  gap: "0.5rem",
                }}
              >
                <p>You clicked {count} times</p>
                <button onClick={() => setCount(count + 1)}>Click me</button>
              </div>
            </div>
          </div>
        );
      };

      // Render the component to the DOM
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html> -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poc Chatbot</title>
    <style>
      body {
        padding: 0 !important;
        margin: 0 !important;
      }

      #root {
        margin-top: -21px;
      }

      .content {
        height: 93vh;
      }

      .message-item {
        background: #fff;
        padding: 5px 10px;
        margin: 5px 0;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const App = () => {
        const containerRef = React.useRef(null);
        const [count, setCount] = React.useState(0);
        const [msg, setMsg] = React.useState("");
        const [messages, setMessages] = React.useState([]);

        const healthEventSource = React.useMemo(
          () => new EventSource("/api/health"),
          []
        );

        React.useEffect(() => {
          // Escuchar mensajes SSE
          healthEventSource.onmessage = ({ data }) => {
            try {
              const response = JSON.parse(data);
              setMessages((prev) => [...prev, response.message]);
            } catch (err) {
              console.error("Error parsing SSE message:", err);
            }
          };

          healthEventSource.onerror = (error) => {
            console.error("SSE error:", error);
          };

          // Cierre limpio al desmontar
          return () => {
            if (healthEventSource.readyState !== EventSource.CLOSED) {
              healthEventSource.close();
            }
          };
        }, [healthEventSource]);

        const sentMessage = async (bodyMsg) => {
          try {
            const urlBot =
              "https://web.furycloud.io/api/proxy/verdi_flows/webhook-test/9c4f0ea5-bf8b-400a-a24e-d82a76b9ec0a";
            const response = await fetch(urlBot, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ context: bodyMsg }), // Convertimos el objeto a JSON
            });

            const result = await response.json();
            console.log(result.data);
          } catch (error) {
            console.error("Error en la petición:", error);
          } finally {
            setMsg("");
            setMessages((prev) => [...prev, bodyMsg]);
          }
        };

        return (
          <div>
            <h4>Poc Chatbot</h4>
            <div
              className="content"
              style={{
                flex: 1,
                display: "flex",
                flexDirection: "column",
                gap: "0.5rem",
              }}
            >
              <div
                ref={containerRef}
                style={{
                  flex: 1,
                  overflowY: "auto",
                  padding: "10px",
                }}
              >
                <h5>Sección de mensajes</h5>
                {messages.map((msg, index) => (
                  <div key={index} className="message-item">
                    {msg}
                  </div>
                ))}
              </div>

              <div
                style={{
                  display: "flex",
                  flexDirection: "row",
                  gap: "0.5rem",
                  padding: "10px",
                }}
              >
                <input
                  style={{
                    flex: 1,
                    borderRadius: "8px",
                    border: "1px solid #bbb",
                    height: "30px",
                  }}
                  value={msg}
                  onChange={({ target }) => setMsg(target.value)}
                />
                <button
                  style={{
                    borderRadius: "8px",
                    border: "1px solid #bbb",
                  }}
                  onClick={() => sentMessage(msg)}
                >
                  Send
                </button>
              </div>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
